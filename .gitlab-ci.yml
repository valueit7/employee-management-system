image: ubuntu:latest

stages:
  - noop
  - tag

noop_job:
  stage: noop
  script:
    - echo "This job does nothing."

tag_job:
  stage: tag
  script:
    - apt-get update && apt-get install -y git  # Installer git
    - git fetch --tags  # Récupérer les tags existants
    - LAST_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "0.0.0")  # Gérer le cas où aucun tag n'existe
    - NEW_VERSION=$(echo $LAST_TAG | awk -F. -v OFS=. '{$NF++;print}')  # Incrémenter la version
    - NEW_TAG="Release $NEW_VERSION"  # Créer le nom du tag
    - git tag -a "$NEW_TAG" -m "Release version $NEW_VERSION"
    - git push origin "$NEW_TAG"